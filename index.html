<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Dashboard</title>
    <style>
        /* --- 基础重置 --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #333; /* 图片加载前的底色 */
            background-size: cover;
            background-position: center;
            transition: background-image 0.8s ease-in-out; /* 背景切换时的平滑过渡 */
        }

        /* --- 遮罩层：让文字更清晰，同时增加深邃感 --- */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
        }

        /* --- 左上角行情卡片 (高级玻璃拟态) --- */
        .market-card {
            position: absolute;
            top: 24px;
            left: 24px;
            width: 350px;
            padding: 15px;
            border-radius: 16px;
            
            /* 玻璃拟态核心代码 */
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            
            /* 交互动画 */
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s;
            cursor: default;
        }

        .market-card:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        /* TradingView 组件容器 */
        .tv-widget-container {
            height: 160px; /* 控制高度 */
            width: 100%;
        }

        /* --- 中间的时间 (可选) --- */
        .clock {
            z-index: 10;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            text-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .clock h1 { font-size: 6rem; font-weight: 200; letter-spacing: -2px; }
        .clock p { font-size: 1.5rem; font-weight: 300; opacity: 0.8; margin-top: -10px;}

    </style>
</head>
<body>

    <div class="overlay"></div>

    <div class="market-card">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
            {
            "colorTheme": "dark",
            "dateRange": "12M",
            "showChart": true,
            "locale": "zh_CN",
            "largeChartUrl": "",
            "isTransparent": true,
            "showSymbolLogo": true,
            "showFloatingTooltip": false,
            "width": "100%",
            "height": "160",
            "plotLineColorGrowing": "rgba(41, 98, 255, 1)",
            "plotLineColorFalling": "rgba(41, 98, 255, 1)",
            "gridLineColor": "rgba(240, 243, 250, 0)",
            "scaleFontColor": "rgba(120, 123, 134, 1)",
            "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)",
            "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)",
            "belowLineFillColorGrowingBottom": "rgba(41, 98, 255, 0)",
            "belowLineFillColorFallingBottom": "rgba(41, 98, 255, 0)",
            "symbolActiveColor": "rgba(41, 98, 255, 0.12)",
            "tabs": [
                {
                "title": "指数",
                "symbols": [
                    { "s": "NASDAQ:QQQ", "d": "Invesco QQQ" },
                    { "s": "AMEX:SPY", "d": "SPDR S&P 500" }
                ],
                "originalTitle": "Indices"
                }
            ]
            }
            </script>
        </div>
        </div>

    <div class="clock">
        <h1 id="time">00:00</h1>
        <p id="date">Loading...</p>
    </div>

    <script>
        // --- 逻辑模块 1: 壁纸缓存与每日刷新 ---
        const setupWallpaper = async () => {
            const today = new Date().toDateString(); // 获取今天的日期字符串 (e.g., "Thu Jan 08 2026")
            const cachedDate = localStorage.getItem('bing_wall_date');
            const cachedUrl = localStorage.getItem('bing_wall_url');
            
            // 策略：如果有缓存且是今天的，直接用缓存；否则去请求新的
            if (cachedDate === today && cachedUrl) {
                console.log("Using cached wallpaper");
                document.body.style.backgroundImage = `url(${cachedUrl})`;
            } else {
                console.log("Fetching new wallpaper...");
                try {
                    // 使用支持跨域的 Bing 镜像 API (返回 JSON)
                    const response = await fetch('https://bing.biturl.top/?resolution=3840&format=json&index=0&mkt=zh-CN');
                    const data = await response.json();
                    const newUrl = data.url;

                    // 图片预加载：等图片下载完再显示，防止背景一片白
                    const img = new Image();
                    img.src = newUrl;
                    img.onload = () => {
                        document.body.style.backgroundImage = `url(${newUrl})`;
                        // 更新缓存
                        localStorage.setItem('bing_wall_date', today);
                        localStorage.setItem('bing_wall_url', newUrl);
                    };
                } catch (e) {
                    console.error("Wallpaper fetch failed, fallback to default", e);
                    // 失败保底：使用 Picsum 随机图
                    document.body.style.backgroundImage = `url(https://picsum.photos/3840/2160?grayscale)`; 
                }
            }
        };

        // --- 逻辑模块 2: 时钟 ---
        const updateClock = () => {
            const now = new Date();
            document.getElementById('time').innerText = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').innerText = now.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        };

        // --- 初始化 ---
        setupWallpaper();
        setInterval(updateClock, 1000);
        updateClock();

    </script>
</body>
</html>
